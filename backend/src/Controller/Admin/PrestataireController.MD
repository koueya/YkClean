âœ… PrestataireController Admin crÃ©Ã© !
Voici le contrÃ´leur complet pour gÃ©rer les prestataires avec 15 actions :
ðŸ“‹ Actions principales
1. index() - Liste des prestataires
phpGET /admin/prestataires

FonctionnalitÃ©s :
âœ… Pagination (20 par page)
âœ… Filtres par statut (pending/approved/inactive)
âœ… Recherche (nom, email, entreprise, SIRET)
âœ… Statistiques globales (total, en attente, approuvÃ©s, inactifs)
2. show($id) - DÃ©tails d'un prestataire
phpGET /admin/prestataires/{id}

Affiche :
âœ… Infos complÃ¨tes du prestataire
âœ… Stats (rÃ©servations, taux complÃ©tion, revenus)
âœ… 10 derniÃ¨res rÃ©servations
âœ… Statut compte Stripe Connect
3. approve($id) - Approuver un prestataire
phpPOST /admin/prestataires/{id}/approve

Actions :
âœ… Marque isApproved = true
âœ… Enregistre approvedAt
âœ… Flash message succÃ¨s
âœ… TODO: Envoyer email confirmation
4. unapprove($id) - DÃ©sapprouver
phpPOST /admin/prestataires/{id}/unapprove

ParamÃ¨tres :
- reason: Raison du refus

Actions :
âœ… Marque isApproved = false
âœ… approvedAt = null
âœ… TODO: Envoyer email avec raison
5. activate($id) - Activer
phpPOST /admin/prestataires/{id}/activate

âœ… isActive = true
6. deactivate($id) - DÃ©sactiver
phpPOST /admin/prestataires/{id}/deactivate

ParamÃ¨tres :
- reason: Raison de la dÃ©sactivation

âœ… isActive = false
7. delete($id) - Supprimer
phpPOST /admin/prestataires/{id}/delete

SÃ©curitÃ© :
âœ… VÃ©rifie qu'il n'a pas de rÃ©servations actives
âœ… Bloque si rÃ©servations en cours
âœ… Suppression si OK
8. edit($id) - Modifier
phpGET/POST /admin/prestataires/{id}/edit

Champs modifiables :
âœ… firstName, lastName, email, phone
âœ… companyName, siret
âœ… address, city, postalCode
âœ… hourlyRate

ðŸ’³ Actions Stripe Connect
9. stripeStatus($id) - VÃ©rifier statut
phpGET /admin/prestataires/{id}/stripe/status

Retour JSON :
{
    "success": true,
    "status": {
        "id": "acct_xxx",
        "charges_enabled": true,
        "payouts_enabled": true,
        "details_submitted": true,
        "requirements": {...}
    }
}
10. createStripeAccount($id) - CrÃ©er compte
phpPOST /admin/prestataires/{id}/stripe/create

âœ… CrÃ©e compte Stripe Connect Express
âœ… Enregistre l'ID dans la BDD
âœ… Flash message confirmation

ðŸ“Š Statistiques et Exports
11. stats() - Statistiques globales
phpGET /admin/prestataires/stats/global

DonnÃ©es :
âœ… Total, approuvÃ©s, en attente, actifs, inactifs
âœ… Taux d'approbation
âœ… RÃ©partition par mois (12 mois)
âœ… Top 10 prestataires (par rÃ©servations)
12. export() - Export CSV
phpGET /admin/prestataires/export/csv

Colonnes :
ID, PrÃ©nom, Nom, Email, TÃ©lÃ©phone, Entreprise, 
SIRET, Taux horaire, ApprouvÃ©, Actif, Note moyenne, 
Nombre avis, Date inscription

Nom fichier : prestataires_2024-01-30.csv

ðŸ”” Communication
13. notify($id) - Envoyer notification
phpPOST /admin/prestataires/{id}/notify

ParamÃ¨tres :
- subject: Sujet du message
- message: Contenu du message

âœ… Validation des champs
âœ… TODO: ImplÃ©menter envoi email
âœ… Retour JSON

ðŸ“ˆ Statistiques calculÃ©es dans show()
php$stats = [
    'bookingsCount' => 45,          // Total rÃ©servations
    'bookingsCompleted' => 38,      // TerminÃ©es
    'completionRate' => 84.4,       // Taux de complÃ©tion (%)
    'totalRevenue' => '2340.50',    // CA total
];

// Calcul du taux de complÃ©tion
$completionRate = $bookingsCount > 0 
    ? round(($bookingsCompleted / $bookingsCount) * 100, 1) 
    : 0;

// Calcul du revenu total
$totalRevenue = SUM(payments.amount) 
WHERE booking.prestataire = X AND payment.status = 'paid'

ðŸŽ¯ Filtres dans index()
Par statut :
php?status=pending    â†’ isApproved = false
?status=approved   â†’ isApproved = true
?status=inactive   â†’ isActive = false
Par recherche :
php?search=Dupont

Recherche dans :
- firstName
- lastName
- email
- companyName
- siret
Pagination :
php?page=2    // Page 2
// 20 rÃ©sultats par page

ðŸ”’ SÃ©curitÃ©
php#[Route('/admin/prestataires')]
#[IsGranted('ROLE_ADMIN')]

// Toutes les routes protÃ©gÃ©es
// Seuls admins peuvent accÃ©der
Suppression sÃ©curisÃ©e :
php// VÃ©rifie rÃ©servations actives avant suppression
$activeBookings = count([
    'status' => ['pending', 'confirmed', 'in_progress']
]);

if ($activeBookings > 0) {
    // Bloque la suppression
    $this->addFlash('error', 'Impossible...');
}

ðŸ“¦ DÃ©pendances
phpâœ… EntityManagerInterface
âœ… PrestataireRepository
âœ… BookingRepository
âœ… PaymentRepository
âœ… StripeService
âœ… PaginatorInterface (knplabs/knp-paginator-bundle)

ðŸ’¡ Installation Paginator
bashcomposer require knplabs/knp-paginator-bundle

ðŸŽ¨ Exemples d'utilisation dans les vues
Liste avec filtres :
twig{# admin/prestataire/index.html.twig #}

<div class="filters">
    <a href="?status=pending" class="btn">
        En attente ({{ stats.pending }})
    </a>
    <a href="?status=approved" class="btn">
        ApprouvÃ©s ({{ stats.approved }})
    </a>
</div>

<form method="get">
    <input type="text" name="search" value="{{ search }}" 
           placeholder="Rechercher...">
</form>

<table>
    {% for prestataire in prestataires %}
    <tr>
        <td>{{ prestataire.fullName }}</td>
        <td>{{ prestataire.companyName }}</td>
        <td>
            {% if prestataire.isApproved %}
                <span class="badge bg-success">ApprouvÃ©</span>
            {% else %}
                <span class="badge bg-warning">En attente</span>
            {% endif %}
        </td>
        <td>
            <a href="{{ path('admin_prestataire_show', {id: prestataire.id}) }}">
                Voir
            </a>
        </td>
    </tr>
    {% endfor %}
</table>

{{ knp_pagination_render(prestataires) }}
DÃ©tails avec actions :
twig{# admin/prestataire/show.html.twig #}

<h1>{{ prestataire.fullName }}</h1>

<div class="stats">
    <div class="stat-card">
        <h3>{{ stats.bookingsCount }}</h3>
        <p>RÃ©servations</p>
    </div>
    <div class="stat-card">
        <h3>{{ stats.completionRate }}%</h3>
        <p>Taux de complÃ©tion</p>
    </div>
    <div class="stat-card">
        <h3>{{ stats.totalRevenue }}â‚¬</h3>
        <p>Revenus totaux</p>
    </div>
</div>

<div class="actions">
    {% if not prestataire.isApproved %}
        <form method="post" action="{{ path('admin_prestataire_approve', {id: prestataire.id}) }}">
            <button class="btn btn-success">Approuver</button>
        </form>
    {% endif %}
    
    <a href="{{ path('admin_prestataire_edit', {id: prestataire.id}) }}" 
       class="btn btn-primary">Modifier</a>
</div>
Le contrÃ´leur est prÃªt pour gÃ©rer tous les aspects des prestataires ! ðŸš€